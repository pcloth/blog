(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{167:function(t,s,a){t.exports=a.p+"assets/img/permission001.0a109325.png"},172:function(t,s,a){"use strict";a.r(s);var n=[function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("div",{staticClass:"content"},[n("h1",{attrs:{id:"django：设计一个权限系统"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#django：设计一个权限系统","aria-hidden":"true"}},[t._v("#")]),t._v(" django：设计一个权限系统")]),t._v(" "),n("div",{staticClass:"tip custom-block"},[n("p",{staticClass:"custom-block-title"},[t._v("为啥不用django自带的权限系统？")]),t._v(" "),n("ul",[n("li",[t._v("django的权限系统缺乏对通一个权限的分级处理功能，如果要实现这个功能，需要设置很多冗长的权限表。")]),t._v(" "),n("li",[t._v("比如：对于订单业务，有些员工需要查看，有些需要能编辑，有些又需要审核退款（删除）权限。")])])]),t._v(" "),n("h2",{attrs:{id:"核心思路"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#核心思路","aria-hidden":"true"}},[t._v("#")]),t._v(" 核心思路")]),t._v(" "),n("ol",[n("li",[t._v("改造用户表"),n("code",[t._v("users")]),t._v("，添加role_id字段，用以标识角色。")]),t._v(" "),n("li",[t._v("添加一个权限表"),n("code",[t._v("role_group")]),t._v("，用以记录各个角色的实际权限。")]),t._v(" "),n("li",[t._v("添加一个菜单表"),n("code",[t._v("menus")]),t._v("，用以映射权限。")]),t._v(" "),n("li",[t._v("权限分级：用"),n("code",[t._v("0表示无权限")]),t._v("，"),n("code",[t._v("1表示可读")]),t._v("，"),n("code",[t._v("2表示可增加")]),t._v("，"),n("code",[t._v("3表示可修改")]),t._v("，"),n("code",[t._v("4表示可删除")]),t._v("，你还可以按照这个思路设计跟多的值。这样，如果一个菜单，某个角色的权限为4，那么他实际上是可以拥有小于等于4的全部权限。")])]),t._v(" "),n("h2",{attrs:{id:"表设计"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#表设计","aria-hidden":"true"}},[t._v("#")]),t._v(" 表设计")]),t._v(" "),n("p",[n("img",{attrs:{src:a(167),alt:"表结构"}})]),t._v(" "),n("h3",{attrs:{id:"users-表"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#users-表","aria-hidden":"true"}},[t._v("#")]),t._v(" users 表")]),t._v(" "),n("h4",{attrs:{id:"role-id-字段"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#role-id-字段","aria-hidden":"true"}},[t._v("#")]),t._v(" role_id 字段")]),t._v(" "),n("ul",[n("li",[t._v("用以关联role_group表。")])]),t._v(" "),n("h3",{attrs:{id:"role-group-表"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#role-group-表","aria-hidden":"true"}},[t._v("#")]),t._v(" role_group 表")]),t._v(" "),n("h4",{attrs:{id:"permission-字段"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#permission-字段","aria-hidden":"true"}},[t._v("#")]),t._v(" permission 字段")]),t._v(" "),n("ul",[n("li",[t._v("这里可以看到，我用了一个json字符串来存储菜单权限，为啥这样做？当然是方便以后扩展非菜单权限（就是不在菜单中显示，但是实际程序代码中又要控制的权限），或者是别的前期想不到的地方。")])]),t._v(" "),n("h3",{attrs:{id:"menus-表"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#menus-表","aria-hidden":"true"}},[t._v("#")]),t._v(" menus 表")]),t._v(" "),n("h4",{attrs:{id:"name-字段"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#name-字段","aria-hidden":"true"}},[t._v("#")]),t._v(" name 字段")]),t._v(" "),n("ol",[n("li",[n("p",[t._v("用来在后端和前端的代码中，检索相应的权限而用的名字。\n这样就可以写一个后端装饰器方法：")]),t._v(" "),n("div",{staticClass:"language-python extra-class"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[n("span",{pre:!0,attrs:{class:"token decorator annotation punctuation"}},[t._v("@permission")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'adminUsers'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("delete_user")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token triple-quoted-string string"}},[t._v("'''删除用户'''")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("pass")]),t._v("\n")])])]),n("p",[t._v("在装饰器方法中，我们就可以去检查用户所指向的role_group.permission字段里是否有"),n("code",[t._v("adminUsers>=4")]),t._v("了，如果否，就抛出403错误给前端。")])]),t._v(" "),n("li",[n("p",[t._v("当然也可以写一个前端装饰器方法：")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[t._v("@"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("permission")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'adminUsers'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("delete_user")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("id")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    ajax"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("delete")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/api/users'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("id"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("id"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("then")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("res")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'删除成功'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])]),t._v(" "),n("li",[n("p",[t._v("前端菜单显示的地方，就直接过滤掉权"),n("code",[t._v("限值==0")]),t._v("的菜单。")])]),t._v(" "),n("li",[n("p",[t._v("前端重点按钮也可以根据这个值而决定是否显示或者"),n("code",[t._v("disabled")])])])]),t._v(" "),n("h4",{attrs:{id:"icon-字段"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#icon-字段","aria-hidden":"true"}},[t._v("#")]),t._v(" icon 字段")]),t._v(" "),n("ul",[n("li",[t._v("用以给前端展示菜单图标")])]),t._v(" "),n("h4",{attrs:{id:"url-字段"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#url-字段","aria-hidden":"true"}},[t._v("#")]),t._v(" url 字段")]),t._v(" "),n("ul",[n("li",[t._v("用来处理前端/后端路由")])])])}],e=a(0),r=Object(e.a)({},function(){this.$createElement;this._self._c;return this._m(0)},n,!1,null,null,null);s.default=r.exports}}]);